{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar _typeof = require('@babel/runtime/helpers/typeof');\nvar _objectSpread = require('@babel/runtime/helpers/objectSpread2');\nvar _classCallCheck = require('@babel/runtime/helpers/classCallCheck');\nvar _createClass = require('@babel/runtime/helpers/createClass');\nvar _defineProperty = require('@babel/runtime/helpers/defineProperty');\nvar runtime = require('@tarojs/runtime');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar _typeof__default = /*#__PURE__*/_interopDefaultLegacy(_typeof);\nvar _objectSpread__default = /*#__PURE__*/_interopDefaultLegacy(_objectSpread);\nvar _classCallCheck__default = /*#__PURE__*/_interopDefaultLegacy(_classCallCheck);\nvar _createClass__default = /*#__PURE__*/_interopDefaultLegacy(_createClass);\nvar _defineProperty__default = /*#__PURE__*/_interopDefaultLegacy(_defineProperty);\n\nfunction isFunction(x) {\n  return typeof x === 'function';\n}\nfunction isUndefined(x) {\n  return typeof x === 'undefined';\n}\nfunction isObject(x) {\n  return _typeof__default['default'](x) === 'object';\n}\n\nfunction isBadObj(x) {\n  !isObject(x) || x === null;\n}\n\nfunction throwTypeError(s) {\n  throw new TypeError(s);\n}\n\nif (!isFunction(Object.assign)) {\n  // Must be writable: true, enumerable: false, configurable: true\n  Object.assign = function (target) {\n    // .length of function is 2\n    if (target == null) {\n      // TypeError if undefined or null\n      throwTypeError('Cannot convert undefined or null to object');\n    }\n\n    var to = Object(target);\n\n    for (var index = 1; index < arguments.length; index++) {\n      var nextSource = arguments[index];\n\n      if (nextSource != null) {\n        // Skip over if undefined or null\n        for (var nextKey in nextSource) {\n          // Avoid bugs when hasOwnProperty is shadowed\n          if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n            to[nextKey] = nextSource[nextKey];\n          }\n        }\n      }\n    }\n\n    return to;\n  };\n}\n\nif (!isFunction(Object.defineProperties)) {\n  Object.defineProperties = function (obj, properties) {\n    function convertToDescriptor(desc) {\n      function hasProperty(obj, prop) {\n        return Object.prototype.hasOwnProperty.call(obj, prop);\n      }\n\n      if (isBadObj(desc)) {\n        throwTypeError('bad desc');\n      }\n\n      var d = {};\n      if (hasProperty(desc, 'enumerable')) d.enumerable = !!desc.enumerable;\n\n      if (hasProperty(desc, 'configurable')) {\n        d.configurable = !!desc.configurable;\n      }\n\n      if (hasProperty(desc, 'value')) d.value = desc.value;\n      if (hasProperty(desc, 'writable')) d.writable = !!desc.writable;\n\n      if (hasProperty(desc, 'get')) {\n        var g = desc.get;\n\n        if (!isFunction(g) && !isUndefined(g)) {\n          throwTypeError('bad get');\n        }\n\n        d.get = g;\n      }\n\n      if (hasProperty(desc, 'set')) {\n        var s = desc.set;\n\n        if (!isFunction(s) && !isUndefined(s)) {\n          throwTypeError('bad set');\n        }\n\n        d.set = s;\n      }\n\n      if (('get' in d || 'set' in d) && ('value' in d || 'writable' in d)) {\n        throwTypeError('identity-confused descriptor');\n      }\n\n      return d;\n    }\n\n    if (isBadObj(obj)) throwTypeError('bad obj');\n    properties = Object(properties);\n    var keys = Object.keys(properties);\n    var descs = [];\n\n    for (var i = 0; i < keys.length; i++) {\n      descs.push([keys[i], convertToDescriptor(properties[keys[i]])]);\n    }\n\n    for (var _i = 0; _i < descs.length; _i++) {\n      Object.defineProperty(obj, descs[_i][0], descs[_i][1]);\n    }\n\n    return obj;\n  };\n}\n\nvar ENV_TYPE = {\n  WEAPP: 'WEAPP',\n  WEB: 'WEB',\n  RN: 'RN',\n  SWAN: 'SWAN',\n  ALIPAY: 'ALIPAY',\n  TT: 'TT',\n  QQ: 'QQ',\n  JD: 'JD'\n};\nfunction getEnv() {\n  if (process.env.TARO_ENV === 'weapp') {\n    return ENV_TYPE.WEAPP;\n  } else if (process.env.TARO_ENV === 'alipay') {\n    return ENV_TYPE.ALIPAY;\n  } else if (process.env.TARO_ENV === 'swan') {\n    return ENV_TYPE.SWAN;\n  } else if (process.env.TARO_ENV === 'tt') {\n    return ENV_TYPE.TT;\n  } else if (process.env.TARO_ENV === 'jd') {\n    return ENV_TYPE.JD;\n  } else if (process.env.TARO_ENV === 'qq') {\n    return ENV_TYPE.QQ;\n  } else if (process.env.TARO_ENV === 'h5') {\n    return ENV_TYPE.WEB;\n  } else if (process.env.TARO_ENV === 'rn') {\n    return ENV_TYPE.RN;\n  } else {\n    return process.env.TARO_ENV || 'Unknown';\n  }\n}\n\nvar Chain = /*#__PURE__*/function () {\n  function Chain(requestParams, interceptors, index) {\n    _classCallCheck__default['default'](this, Chain);\n\n    this.index = index || 0;\n    this.requestParams = requestParams;\n    this.interceptors = interceptors || [];\n  }\n\n  _createClass__default['default'](Chain, [{\n    key: \"proceed\",\n    value: function proceed(requestParams) {\n      this.requestParams = requestParams;\n\n      if (this.index >= this.interceptors.length) {\n        throw new Error('chain 参数错误, 请勿直接修改 request.chain');\n      }\n\n      var nextInterceptor = this._getNextInterceptor();\n\n      var nextChain = this._getNextChain();\n\n      var p = nextInterceptor(nextChain);\n      var res = p.catch(function (err) {\n        return Promise.reject(err);\n      });\n      if (isFunction(p.abort)) res.abort = p.abort;\n      return res;\n    }\n  }, {\n    key: \"_getNextInterceptor\",\n    value: function _getNextInterceptor() {\n      return this.interceptors[this.index];\n    }\n  }, {\n    key: \"_getNextChain\",\n    value: function _getNextChain() {\n      return new Chain(this.requestParams, this.interceptors, this.index + 1);\n    }\n  }]);\n\n  return Chain;\n}();\n\nvar Link = /*#__PURE__*/function () {\n  function Link(interceptor) {\n    _classCallCheck__default['default'](this, Link);\n\n    this.taroInterceptor = interceptor;\n    this.chain = new Chain();\n  }\n\n  _createClass__default['default'](Link, [{\n    key: \"request\",\n    value: function request(requestParams) {\n      var chain = this.chain;\n      var taroInterceptor = this.taroInterceptor;\n      chain.interceptors = chain.interceptors.filter(function (interceptor) {\n        return interceptor !== taroInterceptor;\n      }).concat(taroInterceptor);\n      return chain.proceed(_objectSpread__default['default']({}, requestParams));\n    }\n  }, {\n    key: \"addInterceptor\",\n    value: function addInterceptor(interceptor) {\n      this.chain.interceptors.push(interceptor);\n    }\n  }, {\n    key: \"cleanInterceptors\",\n    value: function cleanInterceptors() {\n      this.chain = new Chain();\n    }\n  }]);\n\n  return Link;\n}();\n\nfunction timeoutInterceptor(chain) {\n  var requestParams = chain.requestParams;\n  var p;\n  var res = new Promise(function (resolve, reject) {\n    var timeout = setTimeout(function () {\n      timeout = null;\n      reject(new Error('网络链接超时,请稍后再试！'));\n    }, requestParams && requestParams.timeout || 60000);\n    p = chain.proceed(requestParams);\n    p.then(function (res) {\n      if (!timeout) return;\n      clearTimeout(timeout);\n      resolve(res);\n    }).catch(function (err) {\n      timeout && clearTimeout(timeout);\n      reject(err);\n    });\n  });\n  if (!isUndefined(p) && isFunction(p.abort)) res.abort = p.abort;\n  return res;\n}\nfunction logInterceptor(chain) {\n  var requestParams = chain.requestParams;\n  var method = requestParams.method,\n      data = requestParams.data,\n      url = requestParams.url;\n\n  if (process.env.NODE_ENV !== 'production') {\n    // eslint-disable-next-line no-console\n    console.log(\"http \".concat(method || 'GET', \" --> \").concat(url, \" data: \"), data);\n  }\n\n  var p = chain.proceed(requestParams);\n  var res = p.then(function (res) {\n    if (process.env.NODE_ENV !== 'production') {\n      // eslint-disable-next-line no-console\n      console.log(\"http <-- \".concat(url, \" result:\"), res);\n    }\n\n    return res;\n  });\n  if (isFunction(p.abort)) res.abort = p.abort;\n  return res;\n}\n\nvar interceptors = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  timeoutInterceptor: timeoutInterceptor,\n  logInterceptor: logInterceptor\n});\n\nfunction Behavior(options) {\n  return options;\n}\nfunction getPreload(current) {\n  return function (key, val) {\n    current.preloadData = isObject(key) ? key : _defineProperty__default['default']({}, key, val);\n  };\n}\nvar defaultDesignWidth = 750;\nvar defaultDesignRatio = {\n  640: 2.34 / 2,\n  750: 1,\n  828: 1.81 / 2\n};\nfunction getInitPxTransform(taro) {\n  return function (config) {\n    var _config$designWidth = config.designWidth,\n        designWidth = _config$designWidth === void 0 ? defaultDesignWidth : _config$designWidth,\n        _config$deviceRatio = config.deviceRatio,\n        deviceRatio = _config$deviceRatio === void 0 ? defaultDesignRatio : _config$deviceRatio;\n    taro.config = taro.config || {};\n    taro.config.designWidth = designWidth;\n    taro.config.deviceRatio = deviceRatio;\n  };\n}\nfunction getPxTransform(taro) {\n  return function (size) {\n    var _ref2 = taro.config || {},\n        _ref2$designWidth = _ref2.designWidth,\n        designWidth = _ref2$designWidth === void 0 ? defaultDesignWidth : _ref2$designWidth,\n        _ref2$deviceRatio = _ref2.deviceRatio,\n        deviceRatio = _ref2$deviceRatio === void 0 ? defaultDesignRatio : _ref2$deviceRatio;\n\n    if (!(designWidth in deviceRatio)) {\n      throw new Error(\"deviceRatio \\u914D\\u7F6E\\u4E2D\\u4E0D\\u5B58\\u5728 \".concat(designWidth, \" \\u7684\\u8BBE\\u7F6E\\uFF01\"));\n    }\n\n    return parseInt(size, 10) * deviceRatio[designWidth] + 'rpx';\n  };\n}\n\n/* eslint-disable camelcase */\nvar Taro = {\n  Behavior: Behavior,\n  getEnv: getEnv,\n  ENV_TYPE: ENV_TYPE,\n  Link: Link,\n  interceptors: interceptors,\n  Current: runtime.Current,\n  getCurrentInstance: runtime.getCurrentInstance,\n  options: runtime.options,\n  nextTick: runtime.nextTick,\n  eventCenter: runtime.eventCenter,\n  Events: runtime.Events,\n  getInitPxTransform: getInitPxTransform\n};\nTaro.initPxTransform = getInitPxTransform(Taro);\nTaro.preload = getPreload(runtime.Current);\nTaro.pxTransform = getPxTransform(Taro);\n\nexports['default'] = Taro;\n//# sourceMappingURL=index.js.map\n"]}